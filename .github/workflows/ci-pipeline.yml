name: ci pipeline for django-job-board application

on:
  workflow_dispatch: 
  push:  

jobs:
  # lint-test:
  #   runs-on: ubuntu-latest
  #   steps:
  #   - name: checkout code
  #     uses: actions/checkout@v4 
  #   - name: Set up Python 3.12
  #     uses: actions/setup-python@v5
  #     with:
  #       python-version: 3.12

  #   - name: Install dependencies
  #     run: |
  #       cd Projects/django-job-board
  #       make setup
  #       make install
  #   - name: lint code
  #     run: |
  #       cd Projects/django-job-board
  #       make lint
  #   - name: unit-testing for Job application
  #     run: | 
  #       cd Projects/django-job-board
  #       make test      
    
  Docker:
    runs-on: ubuntu-latest
    # needs: [lint-test]
    steps:
    # - name: checkout code
    #   uses: actions/checkout@v4 
    - name: Login to Docker Hub
      uses: docker/login-action@v3
      with:
       username: ${{ vars.DOCKERHUB_USERNAME }}
       password: ${{ secrets.DOCKERHUB_TOKEN }}

    - name: Build Docker Image
      uses: docker/build-push-action@v6
      with:
        context: "{{defaultContext}}:./Projects/django-job-board"
        push: false
        tags: ${{ vars.DOCKERHUB_USERNAME }}/django-job-board:${{ github.sha }}
    
    - name: Test Docker Image
      run: | 
        docker images
        docker run -d --name django-job-board -p 8000:8000 ${{ vars.DOCKERHUB_USERNAME }}/django-job-board:${{ github.sha }}
        
        export IP=$(docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' django-job-board )
        echo $IP

        echo Testing Image URL using wget
        curl -s 127.0.0.1:8000/jobs/ | grep "Jobs Available"



# jobs:
#     unit-testing:
#         name: Unit Testing
#         runs-on: ubuntu-latest
#         steps:
#         - name: Checkout Repository
#           uses: actions/checkout@v4

#         - name: Setup NodeJS Version
#           uses: actions/setup-node@v4
#           with:
#             node-version: 20
    
#         - name: Install Dependencies
#           run: npm install
    
#         - name: Unit Testing
#           run: npm test
          
#         - name: Archive Test Result
#           uses: actions/upload-artifact@v4
#           with:
#             name: Mocha-Test-Result
#             path: test-results.xml
            